<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hora Pico - Metro CDMX</title>
    <link rel="stylesheet" href="adicionales.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@700&display=swap" rel="stylesheet">
</head>
<script>
    function actualizarFechaHora() {
        const ahora = new Date();
        const opcionesFecha = { year: 'numeric', month: 'long', day: 'numeric' };
        const opcionesHora = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
        const fecha = ahora.toLocaleDateString('es-MX', opcionesFecha);
        const hora = ahora.toLocaleTimeString('es-MX', opcionesHora);
        document.getElementById('fechaHora').textContent = `${fecha} | ${hora}`;
    }

    setInterval(actualizarFechaHora, 1000);
    actualizarFechaHora();
</script>

    

<body>

    <div class="top-bar">
        <div class="left-text">MetroCDMX</div>
        <div class="right-text" id="fechaHora"></div>
    </div>
    <hr class="divider">


    <div class="container">
        <header class="header">
            <div class="header-top">
                <div class="logo-container">
                    <div class="logo-background"></div>
                    <img src="logo_metro.png" alt="Logo Metro CDMX" class="logo">
                </div>
                <div class="title-container">
                    <div class="title-bg"></div>
                    <h1 class="main-title">Hora Pico</h1>
                </div>
            </div>
            <p class="subtitle">¿Qué tan lleno está el metro hoy?</p>
        </header>

        <section class="main-content">
            <div class="instructions">
                <div class="center-content">
                     <p class="instruction-text">
                        ¿Quieres saber qué tan lleno estará el metro antes de salir de casa? 
                        Con nuestra herramienta puedes anticiparte y planear mejor tu viaje.
                    </p>
                    <img src="mexicometrodibujo.jpg" alt="Metro dibujo" class="instruction-image">
                    <div class="steps-container">
                        <p class="steps-text">
                            <strong>Solo tienes que seguir estos simples pasos:</strong>
                            <br><br>
                            1. Elige la estación que deseas consultar.<br>
                            2. Selecciona la fecha en la que planeas viajar.<br>
                            3. (Opcional) Marca si está lloviendo, ya que la afluencia puede variar con el clima.
                            <br><br>
                            Con esta información, te mostraremos una estimación del nivel de ocupación del metro para que viajes con mayor comodidad y evites aglomeraciones.
                        </p>
                </div>
                </div>
            </div>
            <form id="formularioAfluencia">
                <div class="data-section">
                    <div class="form-group">
                        <label>Estaciones</label>
                        <select id="estaciones" name="estacion" required>
                            <option value="">Selecciona una estación</option>
                            <option value="138">Acatitla</option>
                            <option value="117">Aculco</option>
                            <option value="139">Agrícola Oriental</option>
                            <option value="40">Allende</option>
                            <option value="118">Apatlaco</option>
                            <option value="107">Aquiles Serdán</option>
                            <option value="89">Aragón</option>
                            <option value="21">Atlalilco</option>
                            <option value="108">Auditorio</option>
                            <option value="90">Autobuses del Norte</option>
                            <option value="0">Balbuena</option>
                            <option value="1">Balderas</option>
                            <option value="109">Barranca del Muerto</option>
                            <option value="41">Bellas Artes</option>
                            <option value="80">Bondojito</option>
                            <option value="2">Boulevard Puerto Aéreo</option>
                            <option value="147">Bosque de Aragón</option>
                            <option value="148">Buenavista</option>
                            <option value="22">Calle 11</option>
                            <option value="110">Camarones</option>
                            <option value="140">Canal de San Juan</option>
                            <option value="81">Canal del Norte</option>
                            <option value="3">Candelaria</option>
                            <option value="62">Centro Médico</option>
                            <option value="119">Cerro de la Estrella</option>
                            <option value="42">Chabacano</option>
                            <option value="4">Chapultepec</option>
                            <option value="131">Chilpancingo</option>
                            <option value="149">Ciudad Azteca</option>
                            <option value="132">Ciudad Deportiva</option>
                            <option value="121">Coyuya</option>
                            <option value="43">Colegio Militar</option>
                            <option value="120">Constitución de 1917</option>
                            <option value="111">Constituyentes</option>
                            <option value="82">Consulado</option>
                            <option value="63">Copilco</option>
                            <option value="64">Coyoacán</option>
                            <option value="44">Cuatro Caminos</option>
                            <option value="5">Cuauhtémoc</option>
                            <option value="45">Cuitláhuac</option>
                            <option value="23">Culhuacán</option>
                            <option value="65">Deportivo 18 de Marzo</option>
                            <option value="150">Deportivo Oceanía</option>
                            <option value="66">División del Norte</option>
                            <option value="122">Doctores</option>
                            <option value="151">Ecateoec</option>
                            <option value="91">Eduardo Molina</option>
                            <option value="24">Eje Central</option>
                            <option value="100">El Rosario</option>
                            <option value="25">Ermita</option>
                            <option value="123">Escuadrón 201</option>
                            <option value="67">Etiopía/Plaza de la Transparencia</option>
                            <option value="68">Eugenia</option>
                            <option value="101">Ferrería - Aérea Ciudad de México</option>
                            <option value="83">Fray Servando</option>
                            <option value="124">Garibaldi/Lagunilla</option>
                            <option value="46">General Anaya</option>
                            <option value="6">Gómez Farías</option>
                            <option value="141">Guelatao</option>
                            <option value="69">Guerrero</option>
                            <option value="92">Hangares</option>
                            <option value="47">Hidalgo</option>
                            <option value="20">Hospital 20 de Noviembre</option>
                            <option value="70">Hospital General</option>
                            <option value="152">Impulsora</option>
                            <option value="71">Indios Verdes</option>
                            <option value="7">Insurgentes</option>
                            <option value="26">Insurgentes Sur</option>
                            <option value="93">Instituto del Petróleo</option>
                            <option value="8">Isabel la Católica</option>
                            <option value="125">Iztacalco</option>
                            <option value="126">Iztapalapa</option>
                            <option value="84">Jamaica</option>
                            <option value="9">Juanacatlán</option>
                            <option value="72">Juárez</option>
                            <option value="142">La Paz</option>
                            <option value="73">La Raza</option>
                            <option value="127">La Viga</option>
                            <option value="102">La Villa/Basílica</option>
                            <option value="153">Lagunilla</option>
                            <option value="133">Lázaro Cárdenas</option>
                            <option value="103">Lindavista</option>
                            <option value="27">Lomas Estrella</option>
                            <option value="143">Los Reyes</option>
                            <option value="85">Martín Carrera</option>
                            <option value="10">Merced</option>
                            <option value="28">Mexicaltzingo</option>
                            <option value="74">Miguel Ángel de Quevedo</option>
                            <option value="29">Mixcoac</option>
                            <option value="134">Mixiuhca</option>
                            <option value="11">Moctezuma</option>
                            <option value="86">Morelos</option>
                            <option value="94">Misterios</option>
                            <option value="154">Múzquiz</option>
                            <option value="48">Nativitas</option>
                            <option value="155">Nezahualcóyotl</option>
                            <option value="75">Niños Héroes</option>
                            <option value="30">Nopalera</option>
                            <option value="49">Normal</option>
                            <option value="104">Norte 45</option>
                            <option value="12">Observatorio</option>
                            <option value="128">Obrera</option>
                            <option value="95">Oceanía</option>
                            <option value="31">Olivos</option>
                            <option value="156">Olímpica</option>
                            <option value="13">Pantitlán</option>
                            <option value="50">Panteones</option>
                            <option value="32">Parque de los Venados</option>
                            <option value="135">Patriotismo</option>
                            <option value="144">Peñón Viejo</option>
                            <option value="33">Periférico Oriente</option>
                            <option value="14">Pino Suárez</option>
                            <option value="157">Plaza Aragón</option>
                            <option value="112">Polanco</option>
                            <option value="96">Politécnico</option>
                            <option value="51">Popotla</option>
                            <option value="52">Portales</option>
                            <option value="76">Potrero</option>
                            <option value="136">Puebla</option>
                            <option value="113">Refinería</option>
                            <option value="53">Revolución</option>
                            <option value="158">Ricardo Flores Magón</option>
                            <option value="159">Río de los Remedios</option>
                            <option value="160">Romero Rubio</option>
                            <option value="15">Salto del Agua</option>
                            <option value="34">San Andrés Tomatlán</option>
                            <option value="114">San Antonio</option>
                            <option value="54">San Antonio Abad</option>
                            <option value="55">San Cosme</option>
                            <option value="115">San Joaquín</option>
                            <option value="129">San Juan de Letran</option>
                            <option value="16">San Lázaro</option>
                            <option value="116">San Pedro de los Pinos</option>
                            <option value="87">Santa Anita</option>
                            <option value="145">Santa Marta</option>
                            <option value="17">Sevilla</option>
                            <option value="56">Tacuba</option>
                            <option value="18">Tacubaya</option>
                            <option value="89">Talismán</option>
                            <option value="57">Tasqueña</option>
                            <option value="146">Tepalcates</option>
                            <option value="tepatitlan">Tepatitlán</option>
                            <option value="tepenepantla">Tepenenpantla</option>
                            <option value="tepetitlan">Tepetitlán</option>
                            <option value="tepexpan">Tepexpan</option>
                            <option value="161">Tepito</option>
                            <option value="35">Tezonco</option>
                            <option value="105">Tezozómoc</option>
                            <option value="77">Tlatelolco</option>
                            <option value="37">Tlaltenco</option>
                            <option value="36">Tláhuac</option>
                            <option value="97">Terminal Aérea</option>
                            <option value="99">UAM-Azcapotzalco</option>
                            <option value="130">UAM-I</option>
                            <option value="78">Universidad</option>
                            <option value="106">Vallejo</option>
                            <option value="137">Velódromo</option>
                            <option value="58">Viaducto</option>
                            <option value="162">Villa de Aragón</option>
                            <option value="59">Villa de Cortés</option>
                            <option value="79">Viveros/Derechos Humanos</option>
                            <option value="60">Xola</option>
                            <option value="19">Zaragoza</option>
                            <option value="61">Zócalo/Tenochtitlan</option>
                            <option value="38">Zapata</option>
                            <option value="39">Zapotitlán</option>

                        </select>
                    </div>

                    <div class="form-group"> 
                        <label>Fecha</label>
                        <input type="date" id="fecha" name="fecha" required>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <label for="lluvia">¿Está lloviendo?</label>
                            <input type="checkbox" id="lluvia" name="lluvia" value="true">
                        </div>
                    </div>

                    <button type="submit" class="boton-calcular">
                        Calcular
                    </button>

                    <div class="resultados">
                        <p class="leyenda">Se esperan <span class="valor">──────</span> personas</p>
                        <!-- <p class="leyenda">Se recaudarán <span class="valor">$──────</span> pesos</p> -->
                    </div>
                </div>
            </form>
        </section>
    </div>
    <script>
        function obtenerFecha() {
            const ahora = new Date();
            const opciones = { year: 'numeric', month: 'long', day: 'numeric' };
            return ahora.toLocaleDateString('es-MX', opciones);
        }

        function actualizarHora() {
            const ahora = new Date();
            const hora = ahora.toLocaleTimeString('es-MX', { hour: '2-digit', minute: '2-digit' });
            document.getElementById("hora").textContent = hora;
        }

        document.getElementById("fecha").textContent = obtenerFecha();

        setInterval(actualizarHora, 1000);
        actualizarHora(); 
    </script>

<script>
    document.getElementById("formularioAfluencia").addEventListener("submit", async function(event) {
        event.preventDefault(); 
        console.log('clicked');
    
        const estacion = document.getElementById("estaciones").value;
        const fecha = document.getElementById("fecha").value;
        const llovio = document.getElementById("lluvia").checked ? 1 : 0;
    
        const apiURL = `http://127.0.0.1:8000/predict?fecha=${encodeURIComponent(fecha)}&estacion=${encodeURIComponent(estacion)}&llovio=${llovio}`;
    
        try {
            const response = await fetch(apiURL);
            if (!response.ok) throw new Error("Error en la solicitud");
    
            const data = await response.json();
    
            document.querySelectorAll(".valor")[0].textContent = data.NumPersonas.toLocaleString();
            // document.querySelectorAll(".valor")[1].textContent = `$${data.ingreso.toLocaleString()}`;
        } catch (error) {
            console.error("Error al obtener los datos:", error);
            alert("No se pudo obtener la predicción. Intenta más tarde.");
        }
    });
    </script>
</body>
</html>